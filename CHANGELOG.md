# 更新日志

本文档记录了GROMACS Helper for VS Code扩展的所有重要更改。

## [0.4.0] - 2025-12-25

### 新增

- 🎬 **Mol* 轨迹查看器** - 全新的分子轨迹可视化系统
  - 支持在 VS Code 中直接预览 XTC 和 TRR 轨迹文件
  - 集成 Mol* 分子可视化库，提供专业的3D分子渲染
  - 支持同时加载拓扑文件（GRO、PDB）和轨迹文件
  - **流式轨迹加载器** - 高效加载超大型轨迹文件
    - 按需加载帧数据，显著降低内存占用
    - 支持远程轨迹文件的流式传输
    - 自动建立帧索引，实现快速帧定位
    - 适用于 GB 级别的长期模拟轨迹
  - 支持多个 Mol* 查看器同时打开，基于文件路径独立管理
  - 查看器状态持久化，重启后自动恢复

### 改进

- 优化 Webpack 构建配置，添加监视模式以提升开发体验

### 修复

- 修复 SSH 远程连接时轨迹文件被完整下载到本地的问题
  - 将所有文件读取操作从 Node.js `fs.promises` API 迁移到 `vscode.workspace.fs` API
  - 重构流式轨迹读取器，使用 `vscode.workspace.fs` 支持远程文件系统
  - 确保在 SSH 连接下，轨迹文件在远程服务器上读取，不会触发完整文件下载
- 修复远程连接时文件选择对话框显示本地文件系统的问题
  - 使用 `vscode.Uri.joinPath()` 替代 `vscode.Uri.file()` 来获取父目录 URI
  - 确保文件选择对话框保持远程 URI scheme（如 `vscode-remote://ssh-remote+...`）
  - 修复 `localResourceRoots` 配置，支持远程文件系统
- 修复扩展在远程 SSH 连接时仍然下载轨迹文件的问题
  - 将 `extensionKind` 从 `["workspace", "ui"]` 改为 `["workspace"]`
  - 强制扩展在远程服务器上运行，确保文件读取操作在远程执行
  - Webview 仍然在本地运行，通过 postMessage 与远程扩展主机通信，只传输需要的帧数据

## [0.3.4] - 2025-12-24

### 新增

- 🎯 **GROMACS 命令视图** - 全新的命令管理和执行系统
  - 新增 Activity Bar 中的 "GROMACS Commands" 视图容器
  - 支持命令分组管理（Structure Preparation、Simulation、Analysis 等）
  - 智能占位符系统：
    - `{pdb|gro}` - 自动搜索并选择 .pdb 或 .gro 文件
    - `{output.gro}` - 提示输入输出文件名
    - `{basename}` - 提示输入基本名称（不含扩展名）
  - 文件选择自动使用相对路径，避免路径错误
  - 命令执行后自动发送到专用 "GROMACS" 终端
  - 支持添加、编辑、删除自定义命令和命令组
  - 内置常用 GROMACS 命令模板（pdb2gmx、editconf、solvate、grompp、mdrun 等）
  - 右键菜单和内联按钮快速执行命令

### 改进

- 优化命令执行体验，支持多种占位符类型
- 改进文件搜索和选择流程，支持手动输入文件名

## [0.3.3] - 2025-12-24

### 优化

- 优化拓扑文件 (`.top`, `.itp`) 的符号解析算法，大幅提升处理大型文件时的性能（从 O(N²) 改进为 O(N) 单次遍历）

### 修复

- 修复远程监控脚本部署路径错误，确保能够正确部署至远程服务器

## [0.3.2] - 2025-12-24

### 改进

- 改进mdp文件的格式化功能，让对齐和缩进更加智能
- mdp参数提示添加翻译

## [0.3.0] - 2025-12-23

### 新增

- 🎉 **智能欢迎和更新通知系统**
  - 首次安装时自动显示欢迎通知，点击可查看对应语言的 README 文档
  - 版本更新时自动显示更新通知，点击可查看更新日志
  - 支持中英文自适应：根据 VS Code 语言环境自动选择中文或英文文档和按钮文案
  - 智能去重：同一版本的通知只会显示一次，更新后才会再次提示
  - 可配置禁用：提供"不再显示"按钮，用户可随时关闭通知功能
  - 配置项：`gromacsHelper.disableWelcomeNotifications` 支持手动禁用/启用
- 🔍 **GROMACS 进程监控** - VS Code 状态栏实时监控 GROMACS 运行状态
  - 支持本地进程监控：自动检测本地 `gmx` 进程（pgrep + lsof）
  - 支持远程 SSH 监控：通过 SSH 连接远程服务器并自动部署监控脚本
  - 智能日志解析：自动分析 mdrun 日志提取剩余时间、模拟时间、当前步数等信息
  - 多目标管理：统一配置本地和远程多个监控目标，支持自定义名称
  - 合并显示模式：多个监控目标自动轮转显示（可配置间隔，鼠标悬浮时暂停）
  - 独立显示模式：为重要目标创建独立状态栏项
  - 错误处理：连接失败或解析错误时显示错误图标，鼠标悬浮查看详细原因
  - 点击交互：本地监控可点击状态栏打开工作目录
  - 灵活配置：刷新间隔、轮转间隔、SSH 端口/密钥等均可自定义
  - 10 秒超时控制：防止 SSH 连接阻塞，自动处理超时错误
  - 🆕 **默认启用本地监控**：开箱即用，自动监控本地 GROMACS 进程
  - 🆕 **交互式配置向导**：通过命令面板快速添加和管理监控目标
    - "GROMACS Helper: Add GROMACS Monitor Target" - 交互式添加新监控
    - "GROMACS Helper: Manage GROMACS Monitor Targets" - 管理现有监控目标

## [0.2.3] - 2025-08-11

### 新增
- ✨ **PROPKA pKa 结果文件支持** - 完整支持 PROPKA 程序输出的 pKa 预测结果文件
  - 支持 `.pka` 文件扩展名和文件名模式匹配
  - 详细的语法高亮，包括残基类型、pKa 值、相互作用数据、节区标题等
  - 智能悬停提示：残基信息、参数说明、数值含义解释
  - 文档符号导航：快速跳转到特定残基、摘要部分、能量分析等
  - 代码折叠支持：可折叠文件头部、参考文献、残基表格、摘要、能量和电荷分析等节区
  - 完整的语言支持集成到扩展主系统中

### 改进
- 增强了扩展对生物信息学文件格式的支持范围
- 优化了语言支持系统的可扩展性

## [0.2.1] - 2025-06-24

### 新增
- 新增 packmol 徽标，会自动跟随当前文件刷新预览
- 新增 packmol 预览时 xygauss 和 panel 显示 above、below、over 的箭头，可以更加清晰的辨别方向
- 新增 packmol 背景、主题等个性化设置

### 优化
- 现在 packmol 预览时可以拖动控制面板和折叠

### 修复
- 修复部分 mdp 参数分类类型错误

## [0.2.0] - 2025-06-24

### 新增
- 新增 packmol 文件着色、语法提示
- 新增 packmol 文件结构预览
- 新增 packmol 文件格式化
- 新增 mdp、gro、pdb 文件的语义着色，现在不同的残基和mdp参数能够实现单独的着色
- 新增 mdp 文件语法检验和关联参数的语法检验；新增 pdb 文件关键标记分析
- 🧮 **单位转换计算器** - 专为分子动力学模拟设计的单位转换工具
  - 支持长度单位：nm、Å、pm、m、cm、mm
  - 支持时间单位：fs、ps、ns、μs、ms、s
  - 支持温度单位：K、°C（包含温度偏移转换）
  - 支持能量单位：J、kJ/mol、kJ/kg、J/g、eV、cal、kcal/mol
  - 支持面积单位：nm²、Å²、m²、cm²
  - 支持电势单位：V、mV、kV
  - 提供常用转换参考表和快速转换按钮
  - 现代化的WebView界面，支持VS Code主题
  - 通过命令面板 "GROMACS Helper: Open Unit Converter" 访问

### 修复
- 修复一些已知错误

## [0.1.2] - 2025-06-24

### 修复
- 允许预览 xvg 文件时将标记大小设置为 0

## [0.1.1] - 2025-06-24

### 修复

- 修复项目中各种错误命名的链接

## [0.0.6] - 2025-06-23

### 新增
- ✨ **自定义MDP片段管理功能** - 创建、编辑和管理个性化的MDP文件片段
  - 添加自定义片段，支持智能占位符语法（`${1:default}` 和 `${1|选项1,选项2|}`）
  - 完整的片段编辑功能：修改名称、前缀、描述和内容
  - 可视化片段管理界面，支持增加、删除、修改、预览
  - 侧边栏 "MDP Snippets" 面板，方便快速查看和插入片段
  - 集成到自动补全系统，自定义片段优先显示
  - 命令面板支持：通过 "Manage MDP Snippets" 命令快速访问
  - 上下文菜单支持：在MDP文件中右键直接管理片段

### 改进
- 增强MDP文件的自动补全功能，优先显示自定义片段
- 优化片段存储机制，使用VS Code全局存储确保跨工作区可用
- 改进代码片段的用户体验和可发现性

## [0.0.5] - 2025-06-22

### 新增 
- ✨ **XVG文件可视化预览功能** - 为GROMACS数据文件提供交互式图表预览
  - 支持点击图表图标在侧边栏预览XVG数据为折线图
  - 自动解析XVG文件中的元数据（标题、坐标轴标签、图例等）
  - 多数据系列支持，使用不同颜色区分
  - 实时数据统计显示（数据点数量、数值范围、平均值等）
  - 支持图表缩放、平移和悬停显示具体数值
- 新增XVG文件语法高亮支持
- 新增XVG文件悬停提示功能
- 新增XVG文件代码片段模板
- 提供对`.pdb`文件语法高亮的支持

### 修订
- 修改部分文件名，使命名更规范
- 优化项目结构，增强可维护性

## [0.0.4] - 2025-06-22

### 新增
- 新增GitHub Actions工作流支持自定义发布说明
- 支持从CHANGELOG.md自动读取版本变更信息

### 改进
- 优化构建和发布流程

## [0.0.2] - 2025-06-22

### 新增
- 完整的MDP文件语法高亮支持
- TOP文件语法高亮和符号导航
- GRO文件格式支持和悬停提示
- NDX文件语法高亮和折叠功能
- 智能代码补全和参数提示
- 代码片段支持

### 改进
- 优化语法高亮规则
- 改进悬停提示信息
- 增强符号导航功能

### 修复
- 修复某些情况下的语法解析错误
- 改进文件格式检测

## [0.0.1] - 2025-06-22

### 新增
- 初始版本发布
- 基础的GROMACS文件支持
- MDP参数语法高亮
- 基本的代码补全功能

---

### 格式说明

- **新增**: 新功能
- **改进**: 对现有功能的改进
- **修复**: 错误修复
- **移除**: 移除的功能
- **安全**: 安全相关的修复

### 版本号说明

本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范：
- **主版本号**: 不兼容的API修改
- **次版本号**: 向下兼容的功能性新增
- **修订号**: 向下兼容的问题修正
