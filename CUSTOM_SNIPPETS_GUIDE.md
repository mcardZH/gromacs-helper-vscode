# 自定义MDP片段功能使用指南

## 🎯 功能概述

GROMACS Helper 扩展现在支持用户自定义MDP文件片段功能，让您能够创建、编辑、管理和快速插入个性化的MDP配置模板。

## ✨ 主要功能

### 📋 片段管理
- **➕ 添加新片段**: 创建自定义的MDP配置模板
- **📝 编辑现有片段**: 修改片段内容、名称、前缀或描述
- **🗑️ 删除片段**: 移除不需要的片段
- **📋 列出所有片段**: 查看和预览所有自定义片段
- **🚀 快速插入**: 在MDP文件中快速插入片段

### 🎨 智能片段编辑器
- **可视化编辑**: 在专用编辑器中编辑片段内容
- **语法高亮**: 支持MDP语法高亮
- **占位符支持**: 使用VS Code片段语法
  - `${1:defaultValue}` - 带默认值的占位符
  - `${1|option1,option2,option3|}` - 选择列表
  - `$1`, `$2` - 简单占位符

### 🌳 侧边栏视图
- **MDP Snippets面板**: 在资源管理器中显示所有自定义片段
- **一键插入**: 点击片段即可插入到当前MDP文件
- **上下文菜单**: 右键菜单提供编辑和删除功能

## 🚀 使用方法

### 打开片段管理器
有多种方式打开片段管理器：

1. **命令面板** (推荐)
   - 按 `Ctrl+Shift+P` (macOS: `Cmd+Shift+P`)
   - 输入 "Manage MDP Snippets"
   - 选择命令

2. **右键菜单**
   - 在MDP文件中右键
   - 选择 "Manage MDP Snippets"

3. **侧边栏**
   - 在资源管理器中找到 "MDP Snippets" 面板
   - 点击管理按钮 (🎛️图标)

### 创建新片段

1. 打开片段管理器
2. 选择 "➕ Add New Snippet"
3. 输入片段信息：
   - **Name**: 片段名称 (例如: "my-custom-md")
   - **Prefix**: 触发前缀 (例如: "mymd")
   - **Description**: 描述信息
4. 在打开的编辑器中输入MDP内容
5. 点击 "Save Snippet"

#### 片段语法示例
```mdp
; 自定义MD配置
integrator = ${1|md,md-vv,sd|}
dt = ${2:0.002}
nsteps = ${3:1000000}

; 输出控制
nstxout = ${4:5000}
nstenergy = ${5:1000}

; 温度耦合
tcoupl = ${6|V-rescale,Nose-Hoover,Berendsen|}
tc-grps = ${7:System}
tau_t = ${8:0.1}
ref_t = ${9:300}
```

### 使用自定义片段

#### 方法1: 自动完成
1. 在MDP文件中开始输入片段前缀
2. VS Code会自动显示匹配的片段
3. 选择并插入

#### 方法2: 侧边栏插入
1. 在"MDP Snippets"面板中找到要使用的片段
2. 点击片段名称直接插入
3. 或右键选择"Insert Snippet"

#### 方法3: 片段管理器插入
1. 打开片段管理器
2. 选择 "🚀 Insert Snippet"
3. 选择要插入的片段

### 编辑现有片段

1. 打开片段管理器
2. 选择 "📝 Edit Existing Snippet"
3. 选择要编辑的片段
4. 选择编辑类型：
   - **Edit Content**: 修改片段内容
   - **Edit Name**: 修改片段名称
   - **Edit Prefix**: 修改触发前缀
   - **Edit Description**: 修改描述

### 删除片段

1. 打开片段管理器
2. 选择 "🗑️ Delete Snippet"
3. 选择要删除的片段
4. 确认删除

## 🏃‍♂️ 快速开始

扩展提供了几个预设的片段模板：

- **basicem**: 基础能量最小化模板
- **basicnvt**: 基础NVT平衡模板  
- **basicnpt**: 基础NPT平衡模板

您可以基于这些模板创建自己的自定义片段。

## 💡 最佳实践

### 命名建议
- 使用描述性的名称: `protein-md-production`
- 前缀保持简短: `pmd`
- 添加详细的描述说明片段用途

### 片段设计建议
- 使用占位符让片段更灵活
- 添加注释说明参数用途
- 将相关参数分组
- 提供合理的默认值

### 组织管理
- 为不同类型的模拟创建不同的片段
- 定期清理不再使用的片段
- 导出重要片段进行备份

## 🔧 高级技巧

### 占位符语法
```mdp
; 简单占位符
integrator = $1

; 带默认值的占位符
dt = ${1:0.002}

; 选择列表
tcoupl = ${2|V-rescale,Nose-Hoover,Berendsen|}

; 多行占位符
; ${3:添加其他参数}
```

### 片段变量
使用变量可以在片段中重复使用相同的值：
```mdp
ref_t = ${1:300}
gen_temp = $1  ; 重复使用相同温度
```

## 📦 导入/导出

目前片段存储在VS Code的全局设置中。如果需要备份或分享片段，可以：

1. 通过片段管理器查看片段内容
2. 手动复制到新环境
3. 未来版本将支持导入/导出功能

## 🐛 故障排除

### 常见问题

**Q: 为什么我的自定义片段没有出现在自动完成中？**
A: 确保您在MDP文件中（文件扩展名为.mdp），并且输入的前缀与定义的一致。

**Q: 如何修改现有片段的前缀？**
A: 使用片段管理器的编辑功能，选择"Edit Prefix"。

**Q: 片段存储在哪里？**
A: 片段存储在VS Code的全局存储位置，与工作区无关。

### 技术支持

如果遇到问题，请：
1. 检查VS Code开发者控制台的错误信息
2. 重启VS Code
3. 在GitHub仓库提交issue

## 🎉 享受编码！

有了自定义片段功能，您可以：
- 提高MDP文件编写效率
- 标准化团队的配置模板
- 避免重复输入常用配置
- 减少配置错误

开始创建您的第一个自定义片段吧！🚀
